!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.Skargrid=t()}("undefined"!=typeof self?self:this,function(){class e{constructor(e,t={}){if(this.container=document.getElementById(e),!this.container)throw new Error(`Container com ID "${e}" não encontrado`);this.options={data:t.data||[],columns:t.columns||[],className:t.className||"skargrid",theme:t.theme||"light",pagination:void 0!==t.pagination&&t.pagination,pageSize:t.pageSize||10,pageSizeOptions:t.pageSizeOptions||[10,25,50,100],sortable:void 0!==t.sortable&&t.sortable,selectable:void 0!==t.selectable&&t.selectable,searchable:void 0!==t.searchable&&t.searchable,columnFilters:void 0!==t.columnFilters&&t.columnFilters,columnConfig:void 0!==t.columnConfig&&t.columnConfig,exportCSV:void 0!==t.exportCSV&&t.exportCSV,exportFilename:t.exportFilename||"skargrid-export",...t},this.labels={searchPlaceholder:"Search all columns...",clearFilters:"Clear Filters",exportCSV:"Export CSV",exportXLSX:"Export XLSX",filterTitle:"Filter: {title}",selectAll:"Select All",filterSearchPlaceholder:"Search...",filterInputPlaceholder:"Type to filter...",clear:"Clear",apply:"Apply",showing:"Showing {start} to {end} of {total} entries",filteredOfTotal:"filtered from {total} total",itemsPerPage:"Items per page:",noRowsSelected:"No rows selected to export.",columnConfigTitle:"Configure Columns",columnConfigDescription:"Check to display, drag or use arrows to reorder",restore:"Restore",cancel:"Cancel",noData:"No data available",loading:"Loading...",...t.labels};try{const e=Number(this.options.pageSize)||0;if(e>0){let t=Array.isArray(this.options.pageSizeOptions)?this.options.pageSizeOptions.slice():[];t=t.map(e=>Number(e)).filter(e=>Number.isFinite(e)&&e>0),t.includes(e)||t.push(e);const n=Array.from(new Set(t));n.sort((e,t)=>e-t),this.options.pageSizeOptions=n}}catch(e){console&&console.warn&&console.warn("Skargrid: error normalizing pageSizeOptions",e)}this.currentPage=1,this.totalPages=1,this.sortColumn=null,this.sortDirection=null,this.originalData=[...this.options.data],this.selectedRows=new Set,this.searchText="",this.filteredData=[...this.options.data],this.searchTimeout=null,this.columnFilterValues={},this.columnFilterSelected={},this.isLoading=!1,this.openFilterDropdown=null,this.visibleColumns=new Set(this.options.columns.filter(e=>!1!==e.visible).map(e=>e.field)),this.columnOrder=this.options.columns.map(e=>e.field),i(this),this.init()}getOrderedVisibleColumns(){return this.visibleColumns&&this.columnOrder?this.columnOrder.filter(e=>this.visibleColumns.has(e)).map(e=>this.options.columns.find(t=>t.field===e)).filter(e=>void 0!==e):this.options.columns}init(){this.applyFilters(),this.calculatePagination(),this.render()}calculatePagination(){void 0!==t&&t.calculatePagination(this)}getPageData(){return void 0!==t?t.getPageData(this):this.filteredData}render(e=!0){if(!e&&this.container.querySelector(".skargrid-wrapper"))return void this.updateTableContent();this.container.innerHTML="";const t=document.createElement("div");t.className="skargrid-wrapper","dark"===this.options.theme&&t.classList.add("skargrid-dark");const n=this.renderTopBar();n&&t.appendChild(n);const r=document.createElement("div");if(r.className="skargrid-table-container",this.isLoading){const e=document.createElement("div");e.className="skargrid-loading-overlay",e.innerHTML='\n        <div class="skargrid-spinner">\n          <svg width="40" height="40" viewBox="0 0 50 50">\n            <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-dasharray="80, 200" stroke-linecap="round">\n              <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>\n            </circle>\n          </svg>\n          <span>Carregando...</span>\n        </div>\n      ',r.appendChild(e)}const o=document.createElement("table");o.className=this.options.className;const i=this.renderHeader();o.appendChild(i);const l=this.renderBody();if(o.appendChild(l),r.appendChild(o),t.appendChild(r),this.options.pagination){const e=this.renderPagination();t.appendChild(e)}this.container.appendChild(t)}updateTableContent(){const e=this.container.querySelector(".skargrid");if(!e)return;const t=e.querySelector("tbody"),n=this.renderBody();t&&e.replaceChild(n,t);const r=e.querySelector("thead"),o=this.renderHeader();if(r&&e.replaceChild(o,r),this.options.pagination){const e=this.container.querySelector(".skargrid-pagination"),t=this.renderPagination();e&&e.parentNode&&e.parentNode.replaceChild(t,e)}}renderTopBar(){const e=this.options.searchable,t=this.options.columnConfig&&"function"==typeof this.renderColumnConfigButton,n=this.options.columnFilters,r=this.options.exportCSV&&"function"==typeof this.renderExportCSVButton,o=this.options.exportXLSX&&"function"==typeof this.exportToXLSX&&"function"==typeof this.renderExportCSVButton;if(!(e||t||n||r||o))return null;const i=document.createElement("div");if(i.className="skargrid-search-container",e){const e=this.renderSearchInput();i.appendChild(e)}if(n||t||r||o){const e=document.createElement("div");if(e.className="skargrid-search-actions",n){const t=this.renderClearFiltersButton();e.appendChild(t)}if(t){const t=this.renderColumnConfigButton();e.appendChild(t)}if(r){const t=this.renderExportCSVButton();e.appendChild(t)}if(o){const t=document.createElement("button");t.className="skargrid-clear-filters-btn",t.title=this.labels.exportXLSX,t.innerHTML='\n          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n            <polyline points="7 10 12 15 17 10"></polyline>\n            <line x1="12" y1="15" x2="12" y2="3"></line>\n          </svg>\n          <span style="margin-left:.35rem;font-size:12px">XLSX</span>\n        ',t.onclick=()=>this.exportToXLSX(),e.appendChild(t)}i.appendChild(e)}return i}renderSearchInput(){const e=document.createElement("div");e.className="skargrid-search-wrapper";const t=document.createElement("span");t.className="skargrid-search-icon",t.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <circle cx="11" cy="11" r="8"></circle>\n        <path d="m21 21-4.35-4.35"></path>\n      </svg>\n    ';const n=document.createElement("input");n.type="text",n.className="skargrid-search-input",n.placeholder=this.labels.searchPlaceholder,n.value=this.searchText,n.oninput=e=>{clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.handleSearch(e.target.value)},300)};const r=document.createElement("button");return r.className="skargrid-search-clear",r.innerHTML='\n      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="18" y1="6" x2="6" y2="18"></line>\n        <line x1="6" y1="6" x2="18" y2="18"></line>\n      </svg>\n    ',r.style.display=this.searchText?"flex":"none",r.onclick=()=>{n.value="",n.focus(),this.handleSearch("")},e.appendChild(t),e.appendChild(n),e.appendChild(r),e}renderClearFiltersButton(){const e=document.createElement("button");return e.className="skargrid-clear-filters-btn",e.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>\n        <line x1="18" y1="6" x2="6" y2="18"></line>\n      </svg>\n      <span class="filter-count-badge" style="display: none;">0</span>\n    ',e.title=this.labels.clearFilters,e.onclick=()=>this.clearAllFilters(),this.updateClearFiltersButton(e),e}renderExportCSVButton(){const e=document.createElement("button");return e.className="skargrid-clear-filters-btn",e.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n        <polyline points="7 10 12 15 17 10"></polyline>\n        <line x1="12" y1="15" x2="12" y2="3"></line>\n      </svg>\n      <span style="margin-left:.35rem;font-size:12px">CSV</span>\n    ',e.title=this.labels.exportCSV,e.onclick=()=>this.exportToCSV(),e}renderSearchBox(){return this.renderTopBar()}renderHeader(){const e=document.createElement("thead"),t=document.createElement("tr");if(this.options.selectable){const e=document.createElement("th");e.className="skargrid-select-header";const n=document.createElement("input");n.type="checkbox",n.className="skargrid-checkbox",n.checked=this.isAllSelected(),n.onchange=e=>this.toggleSelectAll(e.target.checked),e.appendChild(n),t.appendChild(e)}return this.getOrderedVisibleColumns().forEach(e=>{const n=document.createElement("th");n.dataset.field=e.field;const r=this.options.sortable&&!1!==e.sortable,o=this.options.columnFilters&&!1!==e.filterable;r&&n.classList.add("sortable");const i=document.createElement("div");i.className="th-content";const l=document.createElement("div");l.className="th-text-sort",r&&(l.style.cursor="pointer",l.onclick=()=>this.handleSort(e.field),this.sortColumn===e.field&&(n.classList.add("sorted"),n.classList.add(this.sortDirection)));const s=document.createElement("span");if(s.className="th-text",s.textContent=e.title||e.field,l.appendChild(s),r){const t=document.createElement("span");t.className="sort-icon",this.sortColumn===e.field?t.textContent="asc"===this.sortDirection?"▲":"▼":t.textContent="⇅",l.appendChild(t)}if(i.appendChild(l),o){const t=document.createElement("button");t.className="th-filter-btn",t.type="button";this.hasActiveFilter(e.field)&&t.classList.add("has-filter"),t.innerHTML='\n          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>\n          </svg>\n        ',t.onclick=n=>{n.stopPropagation(),this.toggleFilterDropdown(e,t)},i.appendChild(t)}n.appendChild(i),t.appendChild(n)}),e.appendChild(t),e}hasActiveFilter(e){return void 0!==o&&o.hasActiveFilter(this,e)}normalizeString(e){return void 0!==o?o.normalizeString(e):e?String(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():""}getUniqueColumnValues(e){return void 0!==o?o.getUniqueColumnValues(this,e):[]}getAvailableColumnValues(e){return void 0!==o?o.getAvailableColumnValues(this,e):[]}toggleFilterDropdown(e,t){if(this.openFilterDropdown&&(this.openFilterDropdown.remove(),this.removeScrollListeners(),this.openFilterDropdown.dataset.field===e.field))return void(this.openFilterDropdown=null);const n=this.createFilterDropdown(e);n.dataset.field=e.field,n.style.visibility="hidden",n.style.position="fixed",document.body.appendChild(n);const r=()=>{const e=t.getBoundingClientRect(),r=n.getBoundingClientRect(),o=window.innerWidth,i=window.innerHeight,l=e.bottom+6;let s=e.left;s+r.width>o-20&&(s=Math.max(10,e.right-r.width));const a=Math.max(0,i-l-12);if(a<120){const e=Math.max(64,a);n.style.maxHeight=e+"px",n.style.overflowY="auto"}else n.style.maxHeight="",n.style.overflowY="";s<10&&(s=10),n.style.top=`${l}px`,n.style.left=`${s}px`};r(),n.style.visibility="visible",this.openFilterDropdown=n;const o=()=>{r()};window.addEventListener("scroll",o,!0),this.scrollHandler=o,setTimeout(()=>{document.addEventListener("click",e=>{n.contains(e.target)||e.target===t||(n.remove(),this.removeScrollListeners(),this.openFilterDropdown=null)},{once:!0})},100)}removeScrollListeners(){this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler,!0),this.scrollHandler=null)}createFilterDropdown(e){const t=document.createElement("div");t.className="skargrid-filter-dropdown";const n=e.filterType||"text";return"select"===n?this.createCheckboxFilter(t,e):this.createInputFilter(t,e,n),t}createCheckboxFilter(e,t){const n=this.getUniqueColumnValues(t.field),r=this.getAvailableColumnValues(t.field);this.columnFilterSelected[t.field]||(this.columnFilterSelected[t.field]=[...n]);const i=document.createElement("div");i.className="filter-dropdown-header",i.innerHTML=`<strong>${this.labels.filterTitle.replace("{title}",t.title||t.field)}</strong>`,e.appendChild(i);const l=document.createElement("div");l.className="filter-search-wrapper";const s=document.createElement("input");s.type="text",s.className="filter-search-input",s.placeholder=this.labels.filterSearchPlaceholder,l.appendChild(s),e.appendChild(l);const a=document.createElement("div");a.className="filter-select-all";const c=document.createElement("input");c.type="checkbox",c.className="skargrid-checkbox",c.id=`select-all-${t.field}`,c.checked=this.columnFilterSelected[t.field].length===n.length;const d=document.createElement("label");d.htmlFor=`select-all-${t.field}`,d.textContent=this.labels.selectAll,a.appendChild(c),a.appendChild(d),e.appendChild(a);const h=document.createElement("div");h.className="filter-list-wrapper";const p=document.createElement("div");p.className="filter-list";let u=[...n];const m=(e=n)=>{u=Array.isArray(e)?e.slice():[...n],p.innerHTML="",e.forEach(e=>{const n=document.createElement("div");n.className="filter-list-item";const i=r.includes(e);i||(n.classList.add("filter-item-disabled"),n.title="Não disponível com os filtros atuais");const l=document.createElement("input");l.type="checkbox",l.className="skargrid-checkbox",l.value=e;const s=String(e).replace(/[^a-z0-9-_]/gi,"_");l.id=`filter-${t.field}-${s}`,l.checked=this.columnFilterSelected[t.field].includes(e),l.disabled=!i;const a=document.createElement("label");a.htmlFor=`filter-${t.field}-${s}`,a.textContent=e===o?.EMPTY_TOKEN||"__SG_EMPTY__"===e?"(Em branco)":e,n.appendChild(l),n.appendChild(a),p.appendChild(n),l.onchange=()=>{l.checked?this.columnFilterSelected[t.field].includes(e)||this.columnFilterSelected[t.field].push(e):this.columnFilterSelected[t.field]=this.columnFilterSelected[t.field].filter(t=>t!==e);const n=u.filter(e=>r.includes(e));c.checked=n.length>0&&n.every(e=>this.columnFilterSelected[t.field].includes(e))}})};m(),h.appendChild(p),e.appendChild(h),s.oninput=e=>{const t=this.normalizeString(e.target.value),r=n.filter(e=>{const n=e===o?.EMPTY_TOKEN||"__SG_EMPTY__"===e?"(Em branco)":String(e);return this.normalizeString(n).includes(t)});m(r)},c.onchange=()=>{const e=u.slice();if(c.checked){const n=new Set(this.columnFilterSelected[t.field]||[]);e.forEach(e=>{r.includes(e)&&n.add(e)}),this.columnFilterSelected[t.field]=[...n]}else this.columnFilterSelected[t.field]=(this.columnFilterSelected[t.field]||[]).filter(t=>!e.includes(t));m(u)};const g=document.createElement("div");g.className="filter-dropdown-footer";const f=document.createElement("button");f.textContent=this.labels.clear,f.className="filter-btn-clear",f.onclick=()=>{this.columnFilterSelected[t.field]=[...n],this.handleColumnFilterCheckbox(t.field),e.remove(),this.removeScrollListeners(),this.openFilterDropdown=null};const C=document.createElement("button");C.textContent=this.labels.apply,C.className="filter-btn-apply",C.onclick=()=>{this.handleColumnFilterCheckbox(t.field),e.remove(),this.removeScrollListeners(),this.openFilterDropdown=null},g.appendChild(f),g.appendChild(C),e.appendChild(g)}createInputFilter(e,t,n){const r=document.createElement("div");r.className="filter-dropdown-header",r.innerHTML=`<strong>${this.labels.filterTitle.replace("{title}",t.title||t.field)}</strong>`,e.appendChild(r);const o=document.createElement("div");o.className="filter-input-wrapper";const i=document.createElement("input");i.type="number"===n?"number":"date"===n?"date":"text",i.className="filter-dropdown-input",i.placeholder=this.labels.filterInputPlaceholder,i.value=this.columnFilterValues[t.field]||"",o.appendChild(i),e.appendChild(o);const l=document.createElement("div");l.className="filter-dropdown-footer";const s=document.createElement("button");s.textContent=this.labels.clear,s.className="filter-btn-clear",s.onclick=()=>{this.handleColumnFilter(t.field,""),e.remove(),this.openFilterDropdown=null};const a=document.createElement("button");a.textContent=this.labels.apply,a.className="filter-btn-apply",a.onclick=()=>{this.handleColumnFilter(t.field,i.value),e.remove(),this.openFilterDropdown=null},l.appendChild(s),l.appendChild(a),e.appendChild(l),i.onkeypress=e=>{"Enter"===e.key&&a.click()},setTimeout(()=>i.focus(),100)}handleColumnFilterCheckbox(e){const t=this.getUniqueColumnValues(e),n=this.columnFilterSelected[e]||[];n.length===t.length?delete this.columnFilterValues[e]:this.columnFilterValues[e]=n,this.currentPage=1,this.applyFilters(),this.calculatePagination(),this.render(!1),this.updateClearFiltersButton()}renderBody(){const e=document.createElement("tbody");return this.getPageData().forEach((t,n)=>{const r=this.options.pagination?(this.currentPage-1)*this.options.pageSize+n:n,o=document.createElement("tr");if(o.dataset.index=r,this.selectedRows.has(r)&&o.classList.add("selected"),this.options.selectable){const e=document.createElement("td");e.className="skargrid-select-cell";const t=document.createElement("input");t.type="checkbox",t.className="skargrid-checkbox",t.checked=this.selectedRows.has(r),t.onchange=e=>{e.stopPropagation(),this.toggleSelectRow(r,e.target.checked)},e.appendChild(t),o.appendChild(e),o.style.cursor="pointer",o.onclick=e=>{"checkbox"!==e.target.type&&(t.checked=!t.checked,this.toggleSelectRow(r,t.checked))}}this.getOrderedVisibleColumns().forEach(e=>{const n=document.createElement("td"),i=t[e.field],l=e.formatter&&"function"==typeof e.formatter?e.formatter:e.render&&"function"==typeof e.render?e.render:null;if(l)try{n.innerHTML=l(i,t,r)}catch(t){n.textContent=null!=i?String(i):"",console&&console.warn&&console.warn("Skargrid: erro ao executar renderer para coluna",e.field,t)}else n.textContent=null!=i?i:"";n.dataset.field=e.field,o.appendChild(n)}),e.appendChild(o)}),e}renderPagination(){return void 0!==t?t.renderPagination(this):document.createElement("div")}goToPage(e){void 0!==t&&t.goToPage(this,e)}changePageSize(e){void 0!==t&&t.changePageSize(this,e)}updateData(e){this.options.data=e,this.originalData=[...e],this.currentPage=1,this.sortColumn=null,this.sortDirection=null,this.selectedRows.clear(),this.searchText="",this.applyFilters(),this.calculatePagination(),this.render()}handleSearch(e){void 0!==o&&o.handleSearch(this,e)}handleColumnFilter(e,t){void 0!==o&&o.handleColumnFilter(this,e,t)}clearColumnFilters(){void 0!==o&&o.clearColumnFilters(this)}clearAllFilters(){void 0!==o&&o.clearAllFilters(this)}updateClearFiltersButton(e=null){if(e||(e=this.container.querySelector(".skargrid-clear-filters-btn")),!e)return;let t=0;this.searchText&&t++,this.options.columns.forEach(e=>{!1!==e.filterable&&this.hasActiveFilter(e.field)&&t++});const n=e.querySelector(".filter-count-badge");t>0?(n.textContent=t,n.style.display="flex",e.classList.add("has-filters")):(n.style.display="none",e.classList.remove("has-filters"))}applyFilters(){void 0!==o&&o.applyFilters(this)}clearSearch(){void 0!==o&&o.clearSearch(this)}handleSort(e){void 0!==n&&n.handleSort(this,e)}sortData(){void 0!==n&&n.sortData(this)}clearSort(){this.sortColumn=null,this.sortDirection=null,this.options.data=[...this.originalData],this.currentPage=1,this.applyFilters(),this.calculatePagination(),this.render()}getData(){return this.options.data}toggleSelectRow(e,t){void 0!==r&&r.toggleSelectRow(this,e,t)}toggleSelectAll(e){void 0!==r&&r.toggleSelectAll(this,e)}isAllSelected(){return void 0!==r&&r.isAllSelected(this)}selectRows(e){void 0!==r&&r.selectRows(this,e)}deselectRows(e){void 0!==r&&r.deselectRows(this,e)}clearSelection(){void 0!==r&&r.clearSelection(this)}getSelectedRows(){return void 0!==r?r.getSelectedRows(this):[]}getSelectedIndices(){return void 0!==r?r.getSelectedIndices(this):[]}showLoading(){this.isLoading=!0}hideLoading(){this.isLoading=!1}destroy(){this.container.innerHTML=""}setTheme(e){if("light"!==e&&"dark"!==e)return void console.warn(`Tema inválido: ${e}. Use 'light' ou 'dark'.`);this.options.theme=e;const t=this.container.querySelector(".skargrid-wrapper");t?"dark"===e?t.classList.add("skargrid-dark"):t.classList.remove("skargrid-dark"):console.warn("Wrapper não encontrado. A tabela foi renderizada?")}}const t={renderPagination(e){const t=document.createElement("div");t.className="skargrid-pagination";const n=this.renderPaginationInfo(e);t.appendChild(n);const r=this.renderPaginationControls(e);t.appendChild(r);const o=this.renderPageSizeSelector(e);return t.appendChild(o),t},renderPaginationInfo(e){const t=document.createElement("div");t.className="skargrid-pagination-info";const n=e.filteredData.length,r=e.options.data.length,o=0===n?0:(e.currentPage-1)*e.options.pageSize+1,i=Math.min(e.currentPage*e.options.pageSize,n);let l=e.labels.showing.replace("{start}",o).replace("{end}",i).replace("{total}",n);return e.searchText&&n<r&&(l+=` (${e.labels.filteredOfTotal.replace("{total}",r)})`),t.textContent=l,t},renderPaginationControls(e){const t=document.createElement("div");t.className="skargrid-pagination-controls";const n=document.createElement("button");n.textContent="«",n.className="skargrid-pagination-btn",n.disabled=1===e.currentPage,n.onclick=()=>this.goToPage(e,1),t.appendChild(n);const r=document.createElement("button");r.textContent="‹",r.className="skargrid-pagination-btn",r.disabled=1===e.currentPage,r.onclick=()=>this.goToPage(e,e.currentPage-1),t.appendChild(r);this.getPageNumbers(e).forEach(n=>{if("..."===n){const e=document.createElement("span");e.textContent="...",e.className="skargrid-pagination-ellipsis",t.appendChild(e)}else{const r=document.createElement("button");r.textContent=n,r.className="skargrid-pagination-btn",n===e.currentPage&&r.classList.add("active"),r.onclick=()=>this.goToPage(e,n),t.appendChild(r)}});const o=document.createElement("button");o.textContent="›",o.className="skargrid-pagination-btn",o.disabled=e.currentPage===e.totalPages,o.onclick=()=>this.goToPage(e,e.currentPage+1),t.appendChild(o);const i=document.createElement("button");return i.textContent="»",i.className="skargrid-pagination-btn",i.disabled=e.currentPage===e.totalPages,i.onclick=()=>this.goToPage(e,e.totalPages),t.appendChild(i),t},getPageNumbers(e){const t=[];if(e.totalPages<=7)for(let n=1;n<=e.totalPages;n++)t.push(n);else{t.push(1);let n=Math.max(2,e.currentPage-1),r=Math.min(e.totalPages-1,e.currentPage+1);e.currentPage<=3?r=4:e.currentPage>=e.totalPages-2&&(n=e.totalPages-3),n>2&&t.push("...");for(let e=n;e<=r;e++)t.push(e);r<e.totalPages-1&&t.push("..."),t.push(e.totalPages)}return t},renderPageSizeSelector(e){const t=document.createElement("div");t.className="skargrid-page-size";const n=document.createElement("span");n.textContent=e.labels.itemsPerPage,t.appendChild(n);const r=document.createElement("select");return r.className="skargrid-page-size-select",e.options.pageSizeOptions.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,t===e.options.pageSize&&(n.selected=!0),r.appendChild(n)}),r.onchange=t=>{this.changePageSize(e,parseInt(t.target.value))},t.appendChild(r),t},goToPage(e,t){t<1||t>e.totalPages||(e.currentPage=t,e.render(!1))},changePageSize(e,t){e.options.pageSize=t,e.currentPage=1,e.calculatePagination(),e.render(!1)},calculatePagination(e){const t=e.filteredData.length;e.totalPages=Math.ceil(t/e.options.pageSize)||1,e.currentPage>e.totalPages&&(e.currentPage=e.totalPages)},getPageData(e){if(!e.options.pagination)return e.filteredData;const t=(e.currentPage-1)*e.options.pageSize,n=t+e.options.pageSize;return e.filteredData.slice(t,n)}},n={getSortValue:(e,t,n)=>t[n.field],handleSort(e,t){e.sortColumn===t?"asc"===e.sortDirection?e.sortDirection="desc":"desc"===e.sortDirection&&(e.sortColumn=null,e.sortDirection=null,e.options.data=[...e.originalData]):(e.sortColumn=t,e.sortDirection="asc"),e.sortColumn&&this.sortData(e),e.currentPage=1,e.calculatePagination(),e.render(!1)},sortData(e){const t=e.options.columns.find(t=>t.field===e.sortColumn);e.options.data.sort((n,r)=>{let o=this.getSortValue(e,n,t),i=this.getSortValue(e,r,t);if(t&&t.sortCompare&&"function"==typeof t.sortCompare)return"asc"===e.sortDirection?t.sortCompare(o,i,n,r):t.sortCompare(i,o,r,n);null===o&&(o=""),null===i&&(i="");const l=t?.sortType||this.inferSortType(o,i);if("number"===l){const t=parseFloat(o)||0,n=parseFloat(i)||0;return"asc"===e.sortDirection?t-n:n-t}if("date"===l){const t=new Date(o),n=new Date(i),r=isNaN(t.getTime())?0:t.getTime(),l=isNaN(n.getTime())?0:n.getTime();return"asc"===e.sortDirection?r-l:l-r}{const t=String(o).toLowerCase(),n=String(i).toLowerCase();return"asc"===e.sortDirection?t.localeCompare(n):n.localeCompare(t)}}),e.applyFilters()},inferSortType(e,t){if(!isNaN(e)&&!isNaN(t)&&""!==e&&""!==t)return"number";const n=/^\d{4}-\d{2}-\d{2}/;return n.test(String(e))&&n.test(String(t))?"date":"string"},renderSortIcon(e,t){const n=document.createElement("span");return n.className="sort-icon",e.sortColumn===t?n.textContent="asc"===e.sortDirection?"▲":"▼":n.textContent="⇅",n}},r={toggleSelectRow(e,t,n){n?e.selectedRows.add(t):e.selectedRows.delete(t),e.render(!1)},toggleSelectAll(e,t){t?e.options.data.forEach((t,n)=>{e.selectedRows.add(n)}):e.selectedRows.clear(),e.render(!1)},isAllSelected:e=>0!==e.options.data.length&&e.selectedRows.size===e.options.data.length,selectRows(e,t){t.forEach(t=>{t>=0&&t<e.options.data.length&&e.selectedRows.add(t)}),e.render()},deselectRows(e,t){t.forEach(t=>{e.selectedRows.delete(t)}),e.render()},clearSelection(e){e.selectedRows.clear(),e.render()},getSelectedRows:e=>Array.from(e.selectedRows).map(t=>e.options.data[t]).filter(e=>void 0!==e),getSelectedIndices:e=>Array.from(e.selectedRows).sort((e,t)=>e-t),renderSelectAllCheckbox(e){const t=document.createElement("input");return t.type="checkbox",t.className="skargrid-checkbox",t.checked=this.isAllSelected(e),t.onchange=t=>this.toggleSelectAll(e,t.target.checked),t},renderRowCheckbox(e,t){const n=document.createElement("input");return n.type="checkbox",n.className="skargrid-checkbox",n.checked=e.selectedRows.has(t),n.onchange=n=>{n.stopPropagation(),this.toggleSelectRow(e,t,n.target.checked)},n}},o={EMPTY_TOKEN:"__SG_EMPTY__",getDisplayValue(e,t,n){let r=t[n.field];const o=n.render&&"function"==typeof n.render?n.render:n.formatter&&"function"==typeof n.formatter?n.formatter:null;if(o)try{const n=o(r,t);r=e.stripHTML(n)}catch{}return r=null==r?"":"boolean"==typeof r?r?"Sim":"Não":r.toString(),r},normalizeString:e=>e?String(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():"",applyFilters(e){let t=[...e.options.data];if(e.searchText){const n=this.normalizeString(e.searchText);t=t.filter(t=>e.options.columns.some(r=>{const o=this.getDisplayValue(e,t,r);if(null===o)return!1;return this.normalizeString(o).includes(n)}))}Object.keys(e.columnFilterValues).length>0&&(t=t.filter(t=>Object.entries(e.columnFilterValues).every(([n,r])=>{const o=e.options.columns.find(e=>e.field===n),i=this.getDisplayValue(e,t,o),l=o?.filterType||"text";if("select"===l)return Array.isArray(r)?Array.isArray(i)?i.some(e=>r.includes(e)):null==i||""===i?r.includes(this.EMPTY_TOKEN):r.includes(i):null==i||""===i?String(r)===String(this.EMPTY_TOKEN):String(i)===String(r);if("number"===l)return!r||null!==i&&Number(i)===Number(r);if("date"===l)return!r||null!==i&&String(i).startsWith(r);{if(!r)return!0;if(null===i)return!1;const e=this.normalizeString(i),t=this.normalizeString(r);return e.includes(t)}}))),e.filteredData=t},handleSearch(e,t){e.searchText=t.trim(),e.currentPage=1,e.openFilterDropdown&&(e.openFilterDropdown.remove(),e.openFilterDropdown=null,e.removeScrollListeners&&e.removeScrollListeners()),this.applyFilters(e),e.calculatePagination(),e.render(!1),e.updateClearFiltersButton()},clearSearch(e){e.searchText="",e.currentPage=1,e.openFilterDropdown&&(e.openFilterDropdown.remove(),e.openFilterDropdown=null,e.removeScrollListeners&&e.removeScrollListeners()),this.applyFilters(e),e.calculatePagination(),e.render()},handleColumnFilter(e,t,n){n?e.columnFilterValues[t]=n:delete e.columnFilterValues[t],e.currentPage=1,this.applyFilters(e),e.calculatePagination(),e.render(!1),e.updateClearFiltersButton()},handleColumnFilterCheckbox(e,t){const n=this.getUniqueColumnValues(e,t),r=e.columnFilterSelected[t]||[];r.length===n.length?delete e.columnFilterValues[t]:e.columnFilterValues[t]=r,e.currentPage=1,this.applyFilters(e),e.calculatePagination(),e.render(!1),e.updateClearFiltersButton()},clearColumnFilters(e){e.columnFilterValues={},e.currentPage=1,this.applyFilters(e),e.calculatePagination(),e.render(!1)},clearAllFilters(e){e.searchText="";const t=e.container.querySelector(".skargrid-search-input");t&&(t.value=""),e.columnFilterValues={},e.columnFilterSelected={},e.options.columns.forEach(t=>{if(!1!==t.filterable&&"select"===t.filterType){const n=this.getUniqueColumnValues(e,t.field);e.columnFilterSelected[t.field]=[...n]}}),e.openFilterDropdown&&(e.openFilterDropdown.remove(),e.openFilterDropdown=null),e.removeScrollListeners&&e.removeScrollListeners(),e.currentPage=1,this.applyFilters(e),e.calculatePagination(),e.render()},getUniqueColumnValues(e,t){const n=e.options.columns.find(e=>e.field===t),r=e.options.data.map(t=>this.getDisplayValue(e,t,n)),o=new Set;let i=!1;r.forEach(e=>{null==e||""===e?i=!0:Array.isArray(e)?e.forEach(e=>{null!=e&&""!==e&&o.add(e)}):o.add(e)});const l=[...o].sort();return i&&l.unshift(this.EMPTY_TOKEN),l},getAvailableColumnValues(e,t){let n=[...e.options.data];if(e.searchText){const t=this.normalizeString(e.searchText);n=n.filter(n=>e.options.columns.some(r=>{const o=this.getDisplayValue(e,n,r);if(null===o)return!1;return this.normalizeString(o).includes(t)}))}Object.keys(e.columnFilterValues).length>0&&(n=n.filter(n=>Object.entries(e.columnFilterValues).every(([r,o])=>{if(r===t)return!0;const i=e.options.columns.find(e=>e.field===r),l=this.getDisplayValue(e,n,i),s=i?.filterType||"text";if("select"===s)return Array.isArray(o)?Array.isArray(l)?l.some(e=>o.includes(e)):null==l||""===l?o.includes(this.EMPTY_TOKEN):o.includes(l):null==l||""===l?String(o)===String(this.EMPTY_TOKEN):String(l)===String(o);if("number"===s)return!o||null!==l&&Number(l)===Number(o);if("date"===s)return!o||null!==l&&String(l).startsWith(o);{if(!o)return!0;if(null===l)return!1;const e=this.normalizeString(l),t=this.normalizeString(o);return e.includes(t)}})));const r=e.options.columns.find(e=>e.field===t),o=n.map(t=>this.getDisplayValue(e,t,r)),i=new Set;let l=!1;o.forEach(e=>{null==e||""===e?l=!0:Array.isArray(e)?e.forEach(e=>{null!=e&&""!==e&&i.add(e)}):i.add(e)});const s=[...i].sort();return l&&s.unshift(this.EMPTY_TOKEN),s},hasActiveFilter(e,t){const n=e.options.columns.find(e=>e.field===t);if(!n||!1===n.filterable)return!1;if("select"===n.filterType){const n=this.getUniqueColumnValues(e,t),r=e.columnFilterSelected[t];return!(!r||0===r.length)&&r.length<n.length}return!!e.columnFilterValues[t]}};function i(e){e.tempVisibleColumns=null,e.tempColumnOrder=null,e.storageKey=e.options.storageKey||`skargrid-config-${e.container.id||"default"}`,e.saveColumnConfig=function(){if(e.options.persistColumnConfig)try{const e={visibleColumns:Array.from(this.visibleColumns),columnOrder:this.columnOrder,timestamp:Date.now()};localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.warn("Não foi possível salvar configuração de colunas:",e)}},e.loadColumnConfig=function(){if(!e.options.persistColumnConfig)return!1;try{const e=localStorage.getItem(this.storageKey);if(!e)return!1;const t=JSON.parse(e),n=this.options.columns.map(e=>e.field),r=t.visibleColumns.filter(e=>n.includes(e)),o=t.columnOrder.filter(e=>n.includes(e));return n.forEach(e=>{o.includes(e)||o.push(e)}),this.visibleColumns=new Set(r),this.columnOrder=o,!0}catch(e){return console.warn("Não foi possível carregar configuração de colunas:",e),!1}},e.clearSavedColumnConfig=function(){try{localStorage.removeItem(this.storageKey)}catch(e){console.warn("Não foi possível limpar configuração:",e)}},e.loadColumnConfig(),e.renderColumnConfigButton=function(){const t=document.createElement("button");return t.className="skargrid-clear-filters-btn",t.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>\n        <circle cx="12" cy="12" r="3"/>\n      </svg>\n    ',t.title=e.labels.columnConfigTitle,t.addEventListener("click",e=>{e.stopPropagation(),this.toggleColumnConfigModal()}),t},e.toggleColumnConfigModal=function(){let e=this.container.querySelector(".skargrid-column-config-modal");if(e)return void e.remove();this.tempVisibleColumns=new Set(this.visibleColumns),this.tempColumnOrder=[...this.columnOrder],e=this.renderColumnConfigModal();this.container.querySelector(".skargrid-wrapper").appendChild(e),e.addEventListener("click",e=>{e.stopPropagation()}),setTimeout(()=>{const t=n=>{e.contains(n.target)||(this.tempVisibleColumns=null,this.tempColumnOrder=null,e.remove(),document.removeEventListener("click",t))};document.addEventListener("click",t)},10)},e.renderColumnConfigModal=function(){const t=document.createElement("div");t.className="skargrid-column-config-modal";const n=document.createElement("div");n.className="skargrid-config-header",n.innerHTML=`\n      <h3>\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;">\n          <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>\n          <circle cx="12" cy="12" r="3"/>\n        </svg>\n        ${e.labels.columnConfigTitle}\n      </h3>\n      <p>${e.labels.columnConfigDescription}</p>\n    `;const r=document.createElement("div");r.className="skargrid-config-header-actions";const o=document.createElement("button");o.className="skargrid-config-action-btn",o.innerHTML=e.labels.restore,o.title="Restaurar configuração padrão",o.addEventListener("click",()=>this.restoreDefaultColumns());const i=document.createElement("button");i.className="skargrid-config-action-btn",i.textContent=e.labels.cancel,i.addEventListener("click",()=>{this.tempVisibleColumns=null,this.tempColumnOrder=null,t.remove()});const l=document.createElement("button");l.className="skargrid-config-action-btn skargrid-config-action-btn-primary",l.textContent=e.labels.apply,l.addEventListener("click",()=>this.applyColumnConfig()),r.appendChild(o),r.appendChild(i),r.appendChild(l),n.appendChild(r);const s=document.createElement("div");return s.className="skargrid-config-list",this.tempColumnOrder.forEach((e,t)=>{const n=this.options.columns.find(t=>t.field===e);if(!n)return;const r=document.createElement("div");r.className="skargrid-config-item",r.dataset.field=e,r.draggable=!0,r.addEventListener("dragstart",t=>{t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e),r.classList.add("dragging")}),r.addEventListener("dragend",()=>{r.classList.remove("dragging"),setTimeout(()=>{const e=Array.from(s.querySelectorAll(".skargrid-config-item"));e.forEach((t,n)=>{const r=t.querySelector(".skargrid-config-move-btn:first-of-type"),o=t.querySelector(".skargrid-config-move-btn:last-of-type");r&&(r.disabled=0===n),o&&(o.disabled=n===e.length-1)})},50)}),r.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="move";const t=s.querySelector(".dragging");if(t&&t!==r){const n=r.getBoundingClientRect(),o=n.top+n.height/2;e.clientY<o?s.insertBefore(t,r):s.insertBefore(t,r.nextSibling)}}),r.addEventListener("drop",e=>{e.preventDefault();const t=Array.from(s.querySelectorAll(".skargrid-config-item"));this.tempColumnOrder=t.map(e=>e.dataset.field),t.forEach((e,n)=>{const r=e.querySelector(".skargrid-config-move-btn:first-of-type"),o=e.querySelector(".skargrid-config-move-btn:last-of-type");r&&(r.disabled=0===n),o&&(o.disabled=n===t.length-1)})});const o=document.createElement("input");o.type="checkbox",o.className="skargrid-checkbox",o.checked=this.tempVisibleColumns.has(e),o.addEventListener("change",t=>{t.target.checked?this.tempVisibleColumns.add(e):this.tempVisibleColumns.delete(e)});const i=document.createElement("label");i.textContent=n.title||e,i.addEventListener("click",()=>{o.checked=!o.checked,o.dispatchEvent(new Event("change"))});const l=document.createElement("span");l.className="skargrid-drag-handle",l.innerHTML="⋮⋮",l.title="Arrastar para reordenar";const a=document.createElement("button");a.className="skargrid-config-move-btn",a.innerHTML="↑",a.disabled=0===t,a.addEventListener("click",()=>this.moveColumnTemp(e,"up"));const c=document.createElement("button");c.className="skargrid-config-move-btn",c.innerHTML="↓",c.disabled=t===this.tempColumnOrder.length-1,c.addEventListener("click",()=>this.moveColumnTemp(e,"down")),r.appendChild(l),r.appendChild(o),r.appendChild(i),r.appendChild(a),r.appendChild(c),s.appendChild(r)}),t.appendChild(n),t.appendChild(s),t},e.moveColumnTemp=function(e,t){const n=this.tempColumnOrder.indexOf(e);if(-1===n)return;const r=[...this.tempColumnOrder];"up"===t&&n>0?[r[n],r[n-1]]=[r[n-1],r[n]]:"down"===t&&n<r.length-1&&([r[n],r[n+1]]=[r[n+1],r[n]]),this.tempColumnOrder=r;const o=this.container.querySelector(".skargrid-column-config-modal");if(o){const e=o.querySelector(".skargrid-config-list");e&&(e.innerHTML="",this.tempColumnOrder.forEach((t,n)=>{const r=this.options.columns.find(e=>e.field===t);if(!r)return;const o=document.createElement("div");o.className="skargrid-config-item",o.dataset.field=t,o.draggable=!0,o.addEventListener("dragstart",e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t),o.classList.add("dragging")}),o.addEventListener("dragend",()=>{o.classList.remove("dragging"),setTimeout(()=>{const t=Array.from(e.querySelectorAll(".skargrid-config-item"));t.forEach((e,n)=>{const r=e.querySelector(".skargrid-config-move-btn:first-of-type"),o=e.querySelector(".skargrid-config-move-btn:last-of-type");r&&(r.disabled=0===n),o&&(o.disabled=n===t.length-1)})},50)}),o.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="move";const n=e.querySelector(".dragging");if(n&&n!==o){const r=o.getBoundingClientRect(),i=r.top+r.height/2;t.clientY<i?e.insertBefore(n,o):e.insertBefore(n,o.nextSibling)}}),o.addEventListener("drop",t=>{t.preventDefault();const n=Array.from(e.querySelectorAll(".skargrid-config-item"));this.tempColumnOrder=n.map(e=>e.dataset.field),n.forEach((e,t)=>{const r=e.querySelector(".skargrid-config-move-btn:first-of-type"),o=e.querySelector(".skargrid-config-move-btn:last-of-type");r&&(r.disabled=0===t),o&&(o.disabled=t===n.length-1)})});const i=document.createElement("input");i.type="checkbox",i.className="skargrid-checkbox",i.checked=this.tempVisibleColumns.has(t),i.addEventListener("change",e=>{e.target.checked?this.tempVisibleColumns.add(t):this.tempVisibleColumns.delete(t)});const l=document.createElement("label");l.textContent=r.title||t,l.addEventListener("click",()=>{i.checked=!i.checked,i.dispatchEvent(new Event("change"))});const s=document.createElement("span");s.className="skargrid-drag-handle",s.innerHTML="⋮⋮",s.title="Arrastar para reordenar";const a=document.createElement("button");a.className="skargrid-config-move-btn",a.innerHTML="↑",a.disabled=0===n,a.addEventListener("click",()=>this.moveColumnTemp(t,"up"));const c=document.createElement("button");c.className="skargrid-config-move-btn",c.innerHTML="↓",c.disabled=n===this.tempColumnOrder.length-1,c.addEventListener("click",()=>this.moveColumnTemp(t,"down")),o.appendChild(s),o.appendChild(i),o.appendChild(l),o.appendChild(a),o.appendChild(c),e.appendChild(o)}))}},e.applyColumnConfig=function(){this.tempVisibleColumns&&(this.visibleColumns=new Set(this.tempVisibleColumns)),this.tempColumnOrder&&(this.columnOrder=[...this.tempColumnOrder]),this.tempVisibleColumns=null,this.tempColumnOrder=null;const e=this.container.querySelector(".skargrid-column-config-modal");e&&e.remove(),this.saveColumnConfig(),this.render()},e.restoreDefaultColumns=function(){this.tempVisibleColumns=new Set(this.options.columns.map(e=>e.field)),this.tempColumnOrder=this.options.columns.map(e=>e.field);const e=this.container.querySelector(".skargrid-column-config-modal");if(e){const t=e.querySelector(".skargrid-config-list");t&&(t.innerHTML="",this.tempColumnOrder.forEach((e,n)=>{const r=this.options.columns.find(t=>t.field===e);if(!r)return;const o=document.createElement("div");o.className="skargrid-config-item",o.dataset.field=e,o.draggable=!0,o.addEventListener("dragstart",t=>{t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e),o.classList.add("dragging")}),o.addEventListener("dragend",()=>{o.classList.remove("dragging"),setTimeout(()=>{const e=Array.from(t.querySelectorAll(".skargrid-config-item"));e.forEach((t,n)=>{const r=t.querySelector(".skargrid-config-move-btn:first-of-type"),o=t.querySelector(".skargrid-config-move-btn:last-of-type");r&&(r.disabled=0===n),o&&(o.disabled=n===e.length-1)})},50)}),o.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="move";const n=t.querySelector(".dragging");if(n&&n!==o){const r=o.getBoundingClientRect(),i=r.top+r.height/2;e.clientY<i?t.insertBefore(n,o):t.insertBefore(n,o.nextSibling)}}),o.addEventListener("drop",e=>{e.preventDefault();const n=Array.from(t.querySelectorAll(".skargrid-config-item"));this.tempColumnOrder=n.map(e=>e.dataset.field),n.forEach((e,t)=>{const r=e.querySelector(".skargrid-config-move-btn:first-of-type"),o=e.querySelector(".skargrid-config-move-btn:last-of-type");r&&(r.disabled=0===t),o&&(o.disabled=t===n.length-1)})});const i=document.createElement("input");i.type="checkbox",i.className="skargrid-checkbox",i.checked=this.tempVisibleColumns.has(e),i.addEventListener("change",t=>{t.target.checked?this.tempVisibleColumns.add(e):this.tempVisibleColumns.delete(e)});const l=document.createElement("label");l.textContent=r.title||e,l.addEventListener("click",()=>{i.checked=!i.checked,i.dispatchEvent(new Event("change"))});const s=document.createElement("span");s.className="skargrid-drag-handle",s.innerHTML="⋮⋮",s.title="Arrastar para reordenar";const a=document.createElement("button");a.className="skargrid-config-move-btn",a.innerHTML="↑",a.disabled=0===n,a.addEventListener("click",()=>this.moveColumnTemp(e,"up"));const c=document.createElement("button");c.className="skargrid-config-move-btn",c.innerHTML="↓",c.disabled=n===this.tempColumnOrder.length-1,c.addEventListener("click",()=>this.moveColumnTemp(e,"down")),o.appendChild(s),o.appendChild(i),o.appendChild(l),o.appendChild(a),o.appendChild(c),t.appendChild(o)}))}},e.setColumnVisibility=function(e,t){t?this.visibleColumns.add(e):this.visibleColumns.delete(e),this.render()},e.reorderColumns=function(e){const t=this.options.columns.map(e=>e.field);e.every(e=>t.includes(e))?(this.columnOrder=e,this.render()):console.warn("Ordem inválida: alguns fields não existem")},e.getOrderedVisibleColumns=function(){return this.columnOrder.filter(e=>this.visibleColumns.has(e)).map(e=>this.options.columns.find(t=>t.field===e)).filter(e=>void 0!==e)}}return function(){"use strict";function t(e){return[255&e,e>>>8&255,e>>>16&255,e>>>24&255]}function n(e){return[255&e,e>>>8&255]}function r(e){const r=[],o=[];let i=0;e.forEach(e=>{const l=(new TextEncoder).encode(e.name),s=e.content,a=function(e){const t=function(){let e;const t=new Uint32Array(256);for(let n=0;n<256;n++){e=n;for(let t=0;t<8;t++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e>>>0}return t}();let n=-1;for(let r=0;r<e.length;r++)n=n>>>8^t[255&(n^e[r])];return(-1^n)>>>0}(s),c=s.length,d=s.length,h=[];h.push(80,75,3,4),h.push(...n(20)),h.push(...n(0)),h.push(...n(0)),h.push(...n(0)),h.push(...n(0)),h.push(...t(a)),h.push(...t(c)),h.push(...t(d)),h.push(...n(l.length)),h.push(...n(0));const p=new Uint8Array(h),u=new Uint8Array(p.length+l.length+s.length);u.set(p,0),u.set(l,p.length),u.set(s,p.length+l.length),r.push(u);const m=[];m.push(80,75,1,2),m.push(...n(20)),m.push(...n(20)),m.push(...n(0)),m.push(...n(0)),m.push(...n(0)),m.push(...n(0)),m.push(...t(a)),m.push(...t(c)),m.push(...t(d)),m.push(...n(l.length)),m.push(...n(0)),m.push(...n(0)),m.push(...n(0)),m.push(...n(0)),m.push(...t(0)),m.push(...t(i));const g=new Uint8Array(m.length+l.length);g.set(new Uint8Array(m),0),g.set(l,m.length),o.push(g),i+=u.length});const l=r.reduce((e,t)=>e+t.length,0),s=o.reduce((e,t)=>e+t.length,0),a=new Uint8Array(l+s+22);let c=0;r.forEach(e=>{a.set(e,c),c+=e.length});const d=c;return o.forEach(e=>{a.set(e,c),c+=e.length}),a.set(new Uint8Array([80,75,5,6]),c),c+=4,a.set(new Uint8Array([0,0,0,0]),c),c+=4,a.set(new Uint8Array(n(o.length)),c),c+=2,a.set(new Uint8Array(n(o.length)),c),c+=2,a.set(new Uint8Array(t(s)),c),c+=4,a.set(new Uint8Array(t(d)),c),c+=4,a.set(new Uint8Array([0,0]),c),c+=2,a.buffer}function o(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+65)+t,e=Math.floor(e/26)-1;return t}e.prototype.renderExportCSVButton=function(){const e=document.createElement("button");return e.className="skargrid-clear-filters-btn",e.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n        <polyline points="7 10 12 15 17 10"></polyline>\n        <line x1="12" y1="15" x2="12" y2="3"></line>\n      </svg>\n    ',e.title="Exportar CSV",e.onclick=()=>this.exportToCSV(),e},e.prototype.exportToCSV=function(e){e=e||this.options.exportFilename+".csv";const t=this.columnOrder.filter(e=>this.visibleColumns.has(e)).map(e=>this.options.columns.find(t=>t.field===e)).filter(e=>e);0===t.length&&t.push(...this.options.columns);const n=[t.map(e=>this.escapeCSV(e.title)).join(",")];(this.filteredData.length>0?this.filteredData:this.data).forEach(e=>{const r=t.map(t=>{let n=e[t.field];const r=t.render&&"function"==typeof t.render?t.render:t.formatter&&"function"==typeof t.formatter?t.formatter:null;if(r)try{const t=r(n,e);n=this.stripHTML(t)}catch(e){console&&console.warn&&console.warn("Skargrid export: erro ao executar renderer para coluna",t.field,e)}return n=null==n?"":"boolean"==typeof n?n?"Sim":"Não":n.toString(),this.escapeCSV(n)});n.push(r.join(","))});const r=n.join("\n"),o=new Blob(["\ufeff"+r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,e);else{const t=document.createElement("a");if(void 0!==t.download){const n=URL.createObjectURL(o);t.setAttribute("href",n),t.setAttribute("download",e),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}}},e.prototype.exportToExcel=function(e){e=e||this.options.exportFilename+".xls";const t=this.columnOrder.filter(e=>this.visibleColumns.has(e)).map(e=>this.options.columns.find(t=>t.field===e)).filter(e=>e);0===t.length&&t.push(...this.options.columns);const n=this.filteredData.length>0?this.filteredData:this.data;let r='<table border="1"><thead><tr>';t.forEach(e=>{r+="<th>"+(e.title||e.field)+"</th>"}),r+="</tr></thead><tbody>",n.forEach(e=>{r+="<tr>",t.forEach(t=>{let n=e[t.field];const o=t.render&&"function"==typeof t.render?t.render:t.formatter&&"function"==typeof t.formatter?t.formatter:null;if(o)try{const t=o(n,e);n=this.stripHTML(t)}catch(e){console&&console.warn&&console.warn("Skargrid exportToExcel: renderer error for",t.field,e)}null==n&&(n="");const i=String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");r+="<td>"+i+"</td>"}),r+="</tr>"}),r+="</tbody></table>";const o=new Blob([`<!DOCTYPE html><html><head><meta charset="utf-8"></head><body>${r}</body></html>`],{type:"application/vnd.ms-excel"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,e);else{const t=document.createElement("a");if(void 0!==t.download){const n=URL.createObjectURL(o);t.setAttribute("href",n),t.setAttribute("download",e),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}}},e.prototype.exportSelectedToExcel=function(e){e=e||this.options.exportFilename+"-selected.xls";const t=this.getSelectedRows();if(0===t.length)return void alert(this.labels.noRowsSelected);const n=this.filteredData;this.filteredData=t,this.exportToExcel(e),this.filteredData=n},e.prototype.escapeCSV=function(e){return"string"!=typeof e&&(e=String(e)),e.includes(",")||e.includes("\n")||e.includes('"')?`"${e=e.replace(/"/g,'""')}"`:e},e.prototype.stripHTML=function(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},e.prototype.exportSelectedToCSV=function(e){e=e||this.options.exportFilename+"-selected.csv";const t=this.getSelectedRows();if(0===t.length)return void alert(this.labels.noRowsSelected);const n=this.filteredData;this.filteredData=t,this.exportToCSV(e),this.filteredData=n},e.prototype.exportToXLSX=function(e){e=e||this.options.exportFilename+".xlsx";const t=this.columnOrder.filter(e=>this.visibleColumns.has(e)).map(e=>this.options.columns.find(t=>t.field===e)).filter(e=>e);0===t.length&&t.push(...this.options.columns);const n=function(e,t,n){const i=[],l=new Map;function s(e){if(l.has(e))return l.get(e);const t=i.length;return i.push(e),l.set(e,t),t}const a=[],c=e.map((e,t)=>{const n=s(String(e.title||e.field));return`<c r="${o(t)}1" t="s"><v>${n}</v></c>`}).join("");a.push(`<row r="1">${c}</row>`);for(let r=0;r<t.length;r++){const i=t[r],l=e.map((e,t)=>{let l=i[e.field];const a=e.render&&"function"==typeof e.render?e.render:e.formatter&&"function"==typeof e.formatter?e.formatter:null;if(a)try{l=a(l,i)}catch{}if(n&&"function"==typeof n&&(l=n(l)),null==l&&(l=""),"number"==typeof l)return`<c r="${o(t)}${r+2}"><v>${l}</v></c>`;const c=s(String(l));return`<c r="${o(t)}${r+2}" t="s"><v>${c}</v></c>`}).join("");a.push(`<row r="${r+2}">${l}</row>`)}const d=`<?xml version="1.0" encoding="UTF-8"?>\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"><sheetData>${a.join("")}</sheetData></worksheet>`,h=i.map(e=>`<si><t>${function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(String(e))}</t></si>`).join(""),p=`<?xml version="1.0" encoding="UTF-8"?>\n<sst xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" count="${i.length}" uniqueCount="${i.length}">${h}</sst>`;return r([{name:"_rels/.rels",content:(new TextEncoder).encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="/xl/workbook.xml"/></Relationships>')},{name:"[Content_Types].xml",content:(new TextEncoder).encode('<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"><Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/><Default Extension="xml" ContentType="application/xml"/><Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/><Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/><Override PartName="/xl/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml"/><Override PartName="/xl/sharedStrings.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml"/></Types>')},{name:"xl/workbook.xml",content:(new TextEncoder).encode('<?xml version="1.0" encoding="UTF-8"?>\n<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><sheets><sheet name="Sheet1" sheetId="1" r:id="rId1"/></sheets></workbook>')},{name:"xl/_rels/workbook.xml.rels",content:(new TextEncoder).encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/><Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/><Relationship Id="rId3" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings" Target="sharedStrings.xml"/></Relationships>')},{name:"xl/worksheets/sheet1.xml",content:(new TextEncoder).encode(d)},{name:"xl/sharedStrings.xml",content:(new TextEncoder).encode(p)},{name:"xl/styles.xml",content:(new TextEncoder).encode('<?xml version="1.0" encoding="UTF-8"?>\n<styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"><fonts count="1"><font><sz val="11"/><color theme="1"/><name val="Calibri"/></font></fonts><fills count="1"><fill><patternFill patternType="none"/></fill></fills><borders count="1"><border/></borders><cellStyleXfs count="1"><xf numFmtId="0"/></cellStyleXfs><cellXfs count="1"><xf numFmtId="0" xfId="0"/></cellXfs></styleSheet>')}])}(t,this.filteredData.length>0?this.filteredData:this.data,this.stripHTML.bind(this)),i=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,e);else{const t=document.createElement("a");if(void 0!==t.download){const n=URL.createObjectURL(i);t.setAttribute("href",n),t.setAttribute("download",e),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}}},e.prototype.exportSelectedToXLSX=function(e){e=e||this.options.exportFilename+"-selected.xlsx";const t=this.getSelectedRows();if(0===t.length)return void alert(this.labels.noRowsSelected);const n=this.filteredData;this.filteredData=t,this.exportToXLSX(e),this.filteredData=n}}(),e});